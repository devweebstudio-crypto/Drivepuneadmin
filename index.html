<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrivePune Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
        h2 { margin-top: 40px; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
        input, select { width: 100%; padding: 10px; margin: 6px 0; }
        button { padding: 12px; width: 100%; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .car-item { background: #e9e9e9; padding: 10px; margin: 10px 0; border-radius: 6px; }
    </style>
</head>

<body>

<div class="container">
    <h1>ðŸš— DrivePune Admin Dashboard</h1>

    <!-- Add Car -->
    <h2>Add New Car</h2>
    <input type="text" id="title" placeholder="Car Title (e.g., Swift Automatic)">
    <input type="text" id="brand" placeholder="Brand (e.g., Maruti)">
    <input type="number" id="year" placeholder="Year">
    <input type="number" id="price_per_day" placeholder="Price Per Day">
    <input type="text" id="image_url" placeholder="Image URL">

    <button onclick="addCar()">Add Car</button>

    <h2>All Cars</h2>
    <div id="carList">Loading...</div>
</div>

<script>
/* -----------------------------------------
   âœ… Initialize Supabase FIRST (Required)
------------------------------------------*/
const supabase = window.supabase.createClient(
    "https://diqgdlodnjtuekouxjsz.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRpcWdkbG9kbmp0dWVrb3V4anN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNzMwMDksImV4cCI6MjA3ODk0OTAwOX0.aK_CKsaEfHxYKvR68xDpWglkvNr5GxkiNNKqleR_mzA"
);

/* -----------------------------------------
   Load Cars After Page Fully Loads
------------------------------------------*/
document.addEventListener("DOMContentLoaded", () => {
    loadCars();
});

/* -----------------------------------------
   Load cars from Supabase
------------------------------------------*/
async function loadCars() {
    document.getElementById("carList").innerHTML = "Loading...";

    const { data, error } = await supabase
        .from("cars")
        .select("*")
        .order("id", { ascending: false });

    if (error) {
        console.error(error);
        document.getElementById("carList").innerHTML = "Error loading cars.";
        return;
    }

    document.getElementById("carList").innerHTML = "";

    data.forEach(car => {
        let div = document.createElement("div");
        div.className = "car-item";
        div.innerHTML = `
            <b>${car.title}</b> (${car.brand}, ${car.year})<br>
            â‚¹${car.price_per_day}/day<br>
            <img src="${car.image_url}" width="200"><br><br>
        `;
        document.getElementById("carList").appendChild(div);
    });
}

/* -----------------------------------------
   Add a new car
------------------------------------------*/
async function addCar() {
    let title = document.getElementById("title").value;
    let brand = document.getElementById("brand").value;
    let year = document.getElementById("year").value;
    let price = document.getElementById("price_per_day").value;
    let image = document.getElementById("image_url").value;

    if (!title || !brand || !year || !price || !image) {
        alert("Please fill all fields");
        return;
    }

    const { data, error } = await supabase
        .from("cars")
        .insert([{ title, brand, year, price_per_day: price, image_url: image }]);

    if (error) {
        alert("Error: " + error.message);
        return;
    }

    alert("Car Added Successfully!");
    loadCars();
}
</script>

</body>
</html>
